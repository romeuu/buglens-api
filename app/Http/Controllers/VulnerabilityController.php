<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Vulnerability;
use App\Enums\VulnerabilityName;
use App\Models\Plugin;

class VulnerabilityController extends Controller
{
    public function index(): array {
        return Vulnerability::paginate(10)->toArray();
    }

    public function show(int $id): array {
        return Vulnerability::where('id', $id)->first()->toArray();
    }

    public function showByVulnName(VulnerabilityName $vulnName): array {
        return Vulnerability::where('vuln_name', $vulnName)->paginate(10)->toArray();
    }

    public function showBySinkName(string $sinkName): array {
        return Vulnerability::where('sink_name', 'like', "%{$sinkName}%")->paginate(10)->toArray();
    }

    public function showByPluginId(int $pluginId): array 
    {
        return Plugin::findOrFail($pluginId)
            ->vulnerabilities()
            ->paginate(10)
            ->toArray();
    }
}
